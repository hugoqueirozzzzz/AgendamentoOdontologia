<!--
const CLIENT_ID = "401599277607-61vu9ijf2562erp02fhhu17sehsh0igs.apps.googleusercontent.com"; 
const API_KEY = "AIzaSyD0TwuHZ1_2GR0O11066ZgaUi0cs1XhNRk"; 
-->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Agendamento de Consultas</title>
<link rel="icon" href="img/icone.png">
  <style>
    body { 
      font-family: Arial, sans-serif; 
      padding: 0; 
      margin: 0; 
      background: #f4f6f9; 
    }
    header {
      background: #1976D2;
      color: white;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      margin: 0;
      font-size: 26px;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    button img {
      width: 18px;
      height: 18px;
    }
    #authorize_button { background: #4285F4; color: white; }
    #signout_button { background: #d32f2f; color: white; }
    label { display:block; margin-top:12px; font-weight: bold; }
    input, select { 
      padding: 8px; 
      margin-top:5px; 
      width: 100%; 
      border:1px solid #ccc; 
      border-radius:6px; 
    }
    #agenda {
      margin-top:20px;
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
      gap: 10px;
    }
    .slot {
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      background: #f1f1f1;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
    .slot span {
      display:block;
      font-weight: bold;
      margin-bottom: 8px;
      font-size: 15px;
    }
    .livre { background:#43a047; color:white; }
    .ocupado { background:#e53935; color:white; }
    .form-section {
      opacity: 0.5;
      pointer-events: none;
    }
    .form-section.active {
      opacity: 1;
      pointer-events: all;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      padding: 15px;
      font-size: 14px;
      color: #777;
    }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ©º Agendamento de Consultas</h1>
  </header>

  <div class="container">
    <div class="actions">
      <button id="authorize_button">
        <img src="https://www.svgrepo.com/show/355037/google.svg" alt="Google"> Login com Google
      </button>
      <button id="signout_button" style="display:none;">
        <img src="https://cdn-icons-png.flaticon.com/512/12635/12635060.png" alt="Sair"> Sair
      </button>
    </div>

    <div id="formulario" class="form-section">
      <label>ðŸ‘¤ Nome do paciente:</label>
      <input type="text" id="nome_paciente" placeholder="Ex: JoÃ£o da Silva">

      <label>ðŸ’‰ Tratamento desejado:</label>
      <select id="tratamento">
        <option value="Consulta Geral">Consulta Geral</option>
        <option value="Limpeza">Limpeza</option>
        <option value="ExtraÃ§Ã£o">ExtraÃ§Ã£o</option>
	<option value="RestauraÃ§Ã£o">RestauraÃ§Ã£o</option>
	<option value="Clareamento">Clareamento</option>
	<option value="Implante">Implante</option>
	<option value="Ortodontia(Aparelho)">Ortodontia(Aparelho)</option>
       
      </select>

<label for="telefone">ðŸ“ž Telefone (com DDD):</label>
<input type="tel" id="telefone" name="telefone" placeholder="(xx) xxxxx-xxxx" 
       pattern="\\([0-9]{2}\\) [0-9]{4,5}-[0-9]{4}" required>



 

      <label>ðŸ“… Escolha o dia:</label>
      <input type="date" id="data_agendamento">

      <div id="agenda"></div>
    </div>
  </div>

  <footer>
    BORCELLE ODONTOLOGIA Â© 2025
  </footer>

  <script>
    // Credenciais fixas
   const CLIENT_ID = "401599277607-61vu9ijf2562erp02fhhu17sehsh0igs.apps.googleusercontent.com"; 
const API_KEY = "AIzaSyD0TwuHZ1_2GR0O11066ZgaUi0cs1XhNRk"; 

    const DISCOVERY_DOC = "https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest";
    const SCOPES = "https://www.googleapis.com/auth/calendar.events";

    let tokenClient;
    let agendados = [];
    const agendaDiv = document.getElementById("agenda");
    const formulario = document.getElementById("formulario");

    const horarios = [];
    for(let h=8; h<=18; h++) horarios.push(`${String(h).padStart(2,"0")}:00`);

    // Carregar APIs
    const gapiScript = document.createElement("script");
    gapiScript.src = "https://apis.google.com/js/api.js";
    gapiScript.onload = gapiLoaded;
    document.body.appendChild(gapiScript);

    const gisScript = document.createElement("script");
    gisScript.src = "https://accounts.google.com/gsi/client";
    gisScript.onload = gisLoaded;
    document.body.appendChild(gisScript);

    function gapiLoaded() { 
      gapi.load("client", async () => { 
        await gapi.client.init({ apiKey: API_KEY, discoveryDocs:[DISCOVERY_DOC] }); 
      }); 
    }
    function gisLoaded() { 
      tokenClient = google.accounts.oauth2.initTokenClient({ client_id: CLIENT_ID, scope: SCOPES, callback: "" }); 
    }

    // BotÃµes de login
    document.getElementById("authorize_button").onclick = () => {
      tokenClient.callback = async (resp) => {
        if(resp.error) throw(resp);
        document.getElementById("authorize_button").style.display = "none";
        document.getElementById("signout_button").style.display = "block";
        formulario.classList.add("active");
      };
      tokenClient.requestAccessToken({prompt:"consent"});
    };

    document.getElementById("signout_button").onclick = () => {
      document.getElementById("authorize_button").style.display = "block";
      document.getElementById("signout_button").style.display = "none";
      formulario.classList.remove("active");
    };

    // Atualiza agenda ao mudar data
    document.getElementById("data_agendamento").addEventListener("change", async () => {
      const dataEscolhida = document.getElementById("data_agendamento").value;
      if(!dataEscolhida) return;
      await listarEventos(dataEscolhida);
      renderAgenda(dataEscolhida);
    });

    // Listar eventos existentes com freebusy
    async function listarEventos(dataEscolhida){
      try {
        const [year, month, day] = dataEscolhida.split("-");
        const startOfDay = new Date(year, month-1, day, 0,0,0).toISOString();
        const endOfDay = new Date(year, month-1, day, 23,59,59).toISOString();

        const resp = await gapi.client.calendar.freebusy.query({
          resource: {
            timeMin: startOfDay,
            timeMax: endOfDay,
            timeZone: "America/Sao_Paulo",
            items: [{ id: "primary" }]
          }
        });

        // Pega apenas os horÃ¡rios ocupados
        agendados = resp.result.calendars.primary.busy.map(busy => busy.start);
      } catch (err) {
        console.error(err);
      }
    }

    // Renderiza horÃ¡rios disponÃ­veis
    function renderAgenda(dataEscolhida){
      agendaDiv.innerHTML = "";

      horarios.forEach(hora => {
        const [h, m] = hora.split(":");
        const slotDiv = document.createElement("div");
        slotDiv.classList.add("slot");

        const [year, month, day] = dataEscolhida.split("-");
        const horarioAtual = new Date(year, month-1, day, parseInt(h),0,0);

        let ocupado = false;
        agendados.forEach(ev => {
          const evHora = new Date(ev);
          if(Math.abs(horarioAtual - evHora) < 60*60*1000) ocupado = true;
        });

        const status = ocupado ? "ocupado" : "livre";
        slotDiv.innerHTML = `<span>${hora}</span>
          <button class="${status}" ${status==="ocupado"?"disabled":""} onclick="agendar('${hora}')">
            ${status==="ocupado"?"Ocupado":"Agendar"}
          </button>`;
        agendaDiv.appendChild(slotDiv);
      });
    }

    // Agendar evento
    async function agendar(hora){
      const nome = document.getElementById("nome_paciente").value.trim();
      const tratamento = document.getElementById("tratamento").value;
      const dataEscolhida = document.getElementById("data_agendamento").value;
      const contato = document.getElementById("telefone").value;
      if(!nome || !tratamento || !dataEscolhida|| !contato){ alert("Preencha todos os campos"); return; }

      const [h, m] = hora.split(":");
      const [year, month, day] = dataEscolhida.split("-");
      const start = new Date(year, month-1, day, parseInt(h),0,0);
      const end = new Date(start.getTime() + 60*60*1000);

      for(let ev of agendados){
        const evHora = new Date(ev);
        if(Math.abs(start - evHora) < 60*60*1000){
          alert("Conflito de horÃ¡rios! Intervalo mÃ­nimo de 1 hora.");
          return;
        }
      }

      const event = {
        summary: `${nome} - ${tratamento} - ${contato}`,
        start: { dateTime: start.toISOString(), timeZone: "America/Sao_Paulo" },
        end: { dateTime: end.toISOString(), timeZone: "America/Sao_Paulo" }
      };

      try{
        await gapi.client.calendar.events.insert({ calendarId:"primary", resource:event });
        agendados.push(start.toISOString());
        alert(`Consulta agendada para ${hora}\nPaciente: ${nome}\nTratamento: ${tratamento}\nContato: ${contato}`);
        renderAgenda(dataEscolhida);
      } catch(err){
        console.error(err);
        alert("Erro ao agendar no Google Calendar");
      }
    }
  </script>
</body>
</html>
